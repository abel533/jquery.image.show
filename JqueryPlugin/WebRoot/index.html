<!DOCTYPE html>
<html>
<head>
<title>测试页面</title>

<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
<meta http-equiv="description" content="this is my page">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
<script type="text/javascript" src="js/jquery.easydrag.js"></script>
<script type="text/javascript" src="js/jQueryRotate.js"></script>
<script type="text/javascript" src="js/jquery.mousewheel.js"></script>
<script type="text/javascript">
	;(function($){
		//显示缩略图
		function showSLT(target,img,opt){
			return function(){
				_showSLT(target,img,opt);
			}
		}
		//缩略图
		function _showSLT(target,img,opt){
			var bl = (img.height()/img.width()).toFixed(1)*10;
			$('<img>').attr('src',img.attr('src'))
					  .css({
					  		'position':'absolute',
					  		'width':opt.sltWidth,
					  		'height':'auto',
					  		'right':0,
					  		'bottom':0,
					  		'border':'1px solid black',
					  		'z-index':200
					  }).appendTo(target);
		}
		
		//显示控制器
		function imgControl(target){
			return function(){
				_imgControl(target);
			}
		}
		//控制器
		function _imgControl(target){
			var bl = (img.height()/img.width()).toFixed(1)*10;
			$('<img>').attr('src',img.attr('src'))
					  .css({
					  		'position':'absolute',
					  		'width':'10%',
					  		'height':'auto',
					  		'right':0,
					  		'bottom':0,
					  		'border':'1px solid black',
					  		'z-index':100
					  }).appendTo(target);
		}
		
		
		
		$.fn.imgShow = function(src,options){
			var opt = $.extend({},$.imgShow.options,options);
			//对当前容器进行调整
			this.css({
				'border':'1px solid black',
				'position':'relative',
				'width':opt.cwidth,
				'height':opt.cheight,
				'margin':'0 auto',
				'text-align':'center',
				'overflow':'hidden'
			});
			var className = 'imgshow'+new Date().getTime();
			$('<img>').attr('src',src)
					  .addClass(className)
					  .css({
					  		'position':'absolute',
					  		'width':'100%',
					  		'height':'auto',
					  		'top':0,
					  		'left':0
					  }).appendTo(this);
			var $img = $('.'+className);
			//添加移动
			$img.easydrag(opt.allowBubbling);
			//添加放大功能
			imgMouseWheel($img);
			//显示缩略图
			if(opt.slt){
				setTimeout(showSLT(this,$img,opt),10);
			}
			//显示控制按钮
			
			return $img;
		}
		
		function imgMouseWheel(target){
			target.bind('mousewheel', function(event, delta, deltaX, deltaY) {
			    var ofx = event.offsetX;
			    var ofy = event.offsetY;
			    var x = target.width();
			    var y = target.height();
			    var dx = ofx*($.imgShow.options.dz/x);
			    var dy = dx*ofy/ofx;
			    var bl = y/x;
			    x += delta*$.imgShow.options.dz;
			    y = x*bl;
			    target.width(x);
			    target.height(y);
			    
			    target.css('left','+='+(-delta*dx)+'px');
			    target.css('top','+='+(-delta*dy)+'px');
			});
		}
		$.imgShow = {};
		$.imgShow.options = {
			dz:40,      		//放大增量
			rota:30,			//旋转增量（单位°）
			slt:true,   		//显示缩略图
			sltWidth:'10%',		//缩略图宽度
			allowBubbling:false,//事件冒泡
			control:true, 		//显示控制键
			cwidth:800,			//容器的宽度
			cheight:600 		//容器的高度
		};
		
		
	})(jQuery);
	
	
	var img = null;
	
	$(function(){
		var src = "images/05.jpg";
		img = $('#cantainer').imgShow(src,{sltWidth:'20%',cwidth:500});
		
		$('#ssz30').click(function(){
			var rota = img.getRotateAngle();
			var jd = 30;
			if(rota.length>0){
				jd += rota[0];
			}
			img.rotate(jd);
		})
	});

</script>
<style type="text/css">
#control{z-index:300;position: absolute;background-color: rgba(0,0,0,0.5);width:100%}
</style>
</head>

<body>
<div id="cantainer">
	<div id="control">
		<input type="button" value="顺时针30°" id="ssz30" title="ctrl + n1"/>
		<input type="button" value="顺时针30°" id="ssz31" />
		<input type="button" value="顺时针30°" id="ssz32" />
		<input type="button" value="顺时针30°" id="ssz33" />
		<input type="button" value="顺时针30°" id="ssz34" />
		<input type="button" value="顺时针30°" id="ssz35" />
	</div>
</div>
</body>
</html>
